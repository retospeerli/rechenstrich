<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Rechenstrich – SVG</title>
  <style>
    :root{font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;background:#e9eef3;}
    body{margin:0;min-height:100vh;display:flex;align-items:center;justify-content:center;padding:16px;}
    .app{background:#fff;border-radius:16px;box-shadow:0 10px 30px rgba(0,0,0,.12);padding:16px;max-width:920px;width:100%;}
    h1{margin:0 0 10px;text-align:center;font-size:1.4rem;}
    .row{display:flex;gap:10px;flex-wrap:wrap;justify-content:center;align-items:center;margin-bottom:12px;}
    input,select,button{font-size:1rem;padding:.55rem .7rem;border-radius:10px;border:1px solid #cbd5e1;}
    button{cursor:pointer;border:none;background:#2563eb;color:#fff;font-weight:700;}
    button:hover{background:#1d4ed8;}
    .wrap{display:flex;justify-content:center;}
    /* “Tafel” Look wie Screenshot */
    .board{
      background:#f6f6f6;
      border:3px solid #9aa3ad;
      border-radius:10px;
      padding:12px;
      width:min(860px,100%);
      box-sizing:border-box;
    }
    .eq{font-size:46px;text-align:center;font-weight:500;letter-spacing:1px;margin:6px 0 10px;}
    .line{height:3px;background:#222;opacity:.65;margin:0 auto 8px;max-width:520px;}
    svg{width:100%;height:auto;display:block;}
    .hint{color:#64748b;text-align:center;font-size:.9rem;margin-top:8px;}
  </style>
</head>
<body>
<div class="app">
  <h1>Rechenstrich (SVG) – Schrittweise wie im Beispiel</h1>

  <div class="row">
    <select id="mode">
      <option value="add">Addition</option>
      <option value="sub">Subtraktion</option>
    </select>
    <input id="a" type="number" value="327" min="0" />
    <span style="font-weight:800;font-size:1.1rem;">±</span>
    <input id="b" type="number" value="238" min="0" />
    <button id="drawBtn">Zeichnen</button>
  </div>

  <div class="wrap">
    <div class="board">
      <div class="eq" id="eqText">327 + 238 =</div>
      <div class="line"></div>
      <svg id="svg" viewBox="0 0 860 260" aria-label="Rechenstrich"></svg>
      <div class="hint">Zerlegung in H/Z/E: z.B. 238 → 200, 30, 8</div>
    </div>
  </div>
</div>

<script>
  const svg = document.getElementById("svg");
  const eqText = document.getElementById("eqText");

  document.getElementById("drawBtn").addEventListener("click", () => {
    const mode = document.getElementById("mode").value;
    const a = Number(document.getElementById("a").value);
    const b = Number(document.getElementById("b").value);
    drawRechenstrich({ a, b, mode });
  });

  // Start-Render
  drawRechenstrich({ a: 327, b: 238, mode: "add" });

  function clearSvg() {
    while (svg.firstChild) svg.removeChild(svg.firstChild);
  }

  function el(name, attrs = {}) {
    const n = document.createElementNS("http://www.w3.org/2000/svg", name);
    for (const [k, v] of Object.entries(attrs)) n.setAttribute(k, String(v));
    return n;
  }

  function decomposeHZE(n) {
    // z.B. 238 -> [200,30,8] (keine 0-Teile)
    const h = Math.floor(n / 100) * 100;
    const z = Math.floor((n % 100) / 10) * 10;
    const e = n % 10;
    return [h, z, e].filter(x => x !== 0);
  }

  function drawRechenstrich({ a, b, mode }) {
    clearSvg();

    const parts = decomposeHZE(b);             // [200,30,8]
    const sign = mode === "add" ? "+" : "−";
    const result = mode === "add" ? (a + b) : (a - b);

    eqText.textContent = `${a} ${sign} ${b} =`;

    // Layout-Koordinaten (ähnlich Screenshot)
    const W = 860, H = 260;
    const baseY = 205;
    const leftPad = 70;
    const rightPad = 70;

    // Punkte (Ticks) erzeugen:
    // Addition: a -> a+p1 -> a+p1+p2 -> ... -> result
    // Subtraktion: a -> a-p1 -> a-p1-p2 -> ... -> result  (in der Reihenfolge 200,30,8)
    const points = [a];
    let cur = a;
    for (const p of parts) {
      cur = mode === "add" ? (cur + p) : (cur - p);
      points.push(cur);
    }

    // Wertebereich fürs Mapping
    const minV = Math.min(...points) - Math.max(10, Math.round(b * 0.08));
    const maxV = Math.max(...points) + Math.max(10, Math.round(b * 0.08));

    const xOf = (v) => {
      const t = (v - minV) / (maxV - minV || 1);
      return leftPad + t * (W - leftPad - rightPad);
    };

    // Grundlinie
    svg.appendChild(el("line", { x1: leftPad, y1: baseY, x2: W - rightPad, y2: baseY, stroke: "#222", "stroke-width": 6, "stroke-linecap": "round", opacity: 0.75 }));

    // Ticks + Zahlen unten
    for (const v of points) {
      const x = xOf(v);
      svg.appendChild(el("line", { x1: x, y1: baseY - 16, x2: x, y2: baseY + 16, stroke: "#222", "stroke-width": 6, "stroke-linecap": "round", opacity: 0.85 }));

      const isResult = (v === points[points.length - 1]);
      const t = el("text", {
        x, y: baseY + 52,
        "text-anchor": "middle",
        "font-size": isResult ? 44 : 44,
        "font-weight": 500,
        fill: isResult && mode === "sub" ? "#b91c1c" : "#111" // im Sub-Bild ist Resultat rot
      });
      t.textContent = String(v);
      svg.appendChild(t);
    }

    // Bögen + Labels
    // Style wie Screenshot: graue Bögen, Labels (200/30/8) über dem Bogen
    const arcStroke = "#555";
    const arcWidth = 4;

    for (let i = 0; i < parts.length; i++) {
      const p = parts[i];

      const from = points[i];
      const to = points[i + 1];
      const x1 = xOf(from);
      const x2 = xOf(to);

      const dx = Math.abs(x2 - x1);
      // Bogenhöhe abhängig von Länge, aber begrenzt
      const arcH = clamp(30 + dx * 0.18, 28, 95);
      const topY = baseY - arcH;

      // Quadratische Bézier-Kurve: M (x1,baseY) Q (mx,topY) (x2,baseY)
      const mx = (x1 + x2) / 2;
      const d = `M ${x1} ${baseY} Q ${mx} ${topY} ${x2} ${baseY}`;

      svg.appendChild(el("path", {
        d,
        fill: "none",
        stroke: arcStroke,
        "stroke-width": arcWidth,
        "stroke-linecap": "round"
      }));

      // Label über dem Bogen
      const label = el("text", {
        x: mx,
        y: topY - 10,
        "text-anchor": "middle",
        "font-size": 34,
        "font-weight": 500,
        fill: "#111"
      });
      label.textContent = String(p);
      svg.appendChild(label);
    }

    // Optional: bei Subtraktion ist die linke Resultatszahl rot (wie Beispiel),
    // bei Addition bleibt alles schwarz (wie Beispiel).
    // (Wenn du beim Add auch das Resultat rot willst, sag kurz.)
  }

  function clamp(x, a, b) { return Math.max(a, Math.min(b, x)); }
</script>
</body>
</html>
